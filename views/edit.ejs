<%- include ('./partials/header') %>
<% let titleTemp = blog.title.split(' ').join('-'); %>

<h6><a class="btn btn-light my-3" href="/admin/index">Back to Admin</a></h6>
<h6 style="display: inline;"><a class="btn btn-light" target="_blank" href="/<%= titleTemp %>">Preview</a></h6>
<div>
    <h1 style="text-align: center;">Edit</h1>
    <form action="/<%= blog._id %>?_method=PUT" method="POST">
        <div class="form-group">
            <label><h6>Title:</h6></label>
            <input class="form-control" type="text" name="blog[title]" value="<%= blog.title %>" required>
        </div>
        <div class="form-group">
            <label><h6>Image:</h6></label>
            <input class="form-control" type="text" name="blog[image]" value="<%= blog.image %>" required>
        </div>
        <div class="form-group">
            <label><h6>Reading Time:</h6></label>
            <input id="reading" class="form-control" type="text" name="blog[reading]" value="<%= blog.reading %>" required>
        </div>
        <div class="form-group">
            <label><h6>Date:</h6></label>
            <input class="form-control" type="text" name="blog[created]" value="<%= blog.created %>" required>
        </div>
        <div class="form-group">
            <label><h6>Blog Content:</h6></label>
            <textarea class="form-control" name="blog[body]" rows="30" required><%= blog.body %></textarea>
        </div>
        <p>
            <h6>Words: </h6>
            <span id="words"></span>
        </p>
        <label><h6>Public:</h6></label>
        <% if (blog.public == 'true') { %>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="blog[public]" value="true" checked>
                <label>Yes</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="blog[public]" value="false">
                <label>No</label>
            </div>
        <% } else { %>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="blog[public]" value="true">
                <label>Yes</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="blog[public]" value="false" checked>
                <label>No</label>
            </div>
        <% } %>
        <h6><input class="btn btn-light" type="submit"></h6>
    </form>
</div>

<script>
    const textarea = document.querySelector("textarea");
    const wordsSpan = document.getElementById("words");
    wordsSpan.textContent = textarea.value.split(' ').length;
    const wordsPerMinute = 200;
    let result;

    textarea.addEventListener("input", event => {
        const numberOfWords = event.currentTarget.value.split(' ').length;
        wordsSpan.textContent = numberOfWords;
        
        if (numberOfWords > 0) {
          let value = Math.ceil(numberOfWords / wordsPerMinute);
          result = `${value} minutes`;
        }
        document.getElementById("reading").value = result;
    });
</script>

<%- include ('./partials/footer') %>